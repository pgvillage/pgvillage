---
# handlers file for stolon

- name: Restart stolon-stkeeper
  become: yes
  systemd:
    name: "stolon-keeper.service"
    state: restarted
    enabled: yes
    daemon_reload: yes
  throttle: 1

- name: Restart stolon-stsentinel
  become: yes
  systemd:
    name: "stolon-sentinel.service"
    state: restarted
    enabled: yes
    daemon_reload: yes
  throttle: 1

- name: Restart stolon-stproxy
  become: yes
  systemd:
    name: "stolon-proxy.service"
    state: restarted
    enabled: yes
    daemon_reload: yes
  throttle: 1

- name: Update cluster spec
  become: yes
  become_user: "{{ stolon_user }}"
  shell:
    cmd: '/usr/local/bin/stolonctl update --patch --file "${STOLONCTL_FILE}"'
  environment:
    STOLONCTL_CLUSTER_NAME: "{{ stolon_cluster_name }}"
    STOLONCTL_STORE_BACKEND: "{{ stolon_store_backend }}"
    STOLONCTL_FILE: "{{ stolon_custom_config_file }}"
  throttle: 1

- name: appy sysctl changes
  shell: 'sysctl --system'

