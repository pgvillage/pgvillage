---
- name: "Run the playbook"
  hosts:
    - all
  vars_prompt:
    - name: sure
      prompt: "This will remove postgres and all backups. Are you really sure? Type 'yes' in uppercase if you are..."
      private: no
  become: true
  tasks:
    - name: "Are you sure?"
      assert:
        that:
          - "sure == 'YES'"
    - name: "Run uninstall"
      script: uninstall.sh
    - name: remove packages
      yum:
        name: "{{ item }}"
        state: absent
      loop:
      - stolon
      - avchecker
      - pgroute66
      - haproxy
      - "postgresql{{ linux_pg_version|replace('.','') }}"
      - "postgresql{{ linux_pg_version|replace('.','') }}-server"
      - "postgresql{{ linux_pg_version|replace('.','') }}-contrib"
      - "postgresql{{ linux_pg_version|replace('.','') }}-devel"
      - "postgresql{{ linux_pg_version|replace('.','') }}-plpython3"
      - "stolon"
      - "wal-g-pg"
      - "etcd"

    - name: remove users, do not remove minio user ( backups.. )
      shell: "killall -KILL -u {{ item }}; userdel -fr {{ item }}" 
      loop:
      - stolon
      - postgres
      - avchecker
      - pgquartz
      - etcd
      - pgroute66
      - haproxy
      - keepalived
